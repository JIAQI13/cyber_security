<link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
<link rel="stylesheet" href="https://jqueryui.com/resources/demos/style.css">
<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

<pre>

    <!--#####################################################-->
    <h1>#Set up</h1>

    <a title="Add routing for groups">sudo ip route add 10.229.1.0/24  via 10.229.100.130 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.2.0/24  via 10.229.100.131 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.3.0/24  via 10.229.100.132 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.4.0/24  via 10.229.100.133 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.5.0/24  via 10.229.100.134 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.6.0/24  via 10.229.100.135 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.7.0/24  via 10.229.100.136 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.8.0/24  via 10.229.100.137 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.9.0/24  via 10.229.100.138 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.10.0/24 via 10.229.100.139 dev eth1</a>
    <a title="Add routing for groups">sudo ip route add 10.229.11.0/24 via 10.229.100.140 dev eth1</a>

    <a title="Windows route">route add 10.229.0.0 mask 255.255.0.0 10.229.12.4</a>

    <a title="Load ftp module to track passive connection">modprobe ip_conntrack_ftp</a>

    <a title="Enable IP forwarding">sudo sysctl -w net.ipv4.ip_forward=1</a>

    <a title="Pretend FORWARD packet from Windows VM is from eth1">sudo iptables -t nat -A POSTROUTING -o eth1 -j MASQUERADE</a>

    <!--#####################################################-->
    <h1>#Inbound rules for Linux VM</h1>

    <a title="Log incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.51</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.143</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.51.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.139</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.10.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP HTTP REQ "</a>

    <a title="Log incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.51</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.143</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.51.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.139</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.10.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX DROP FTP REQ "</a>

    <a title="Log incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.51 </a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.143</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.51.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.139</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.10.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX BLOCK FTP PASSIVE "</a>

    <a title="Drop incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.51</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.143</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.51.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.139</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.10.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Allow incoming http packet from allowed hosts to Linux VM"  >sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Drop incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.51</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.143</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.51.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.139</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.10.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Drop incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.51 </a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.143</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.51.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.139</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.10.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Allow incoming passive ftp packet from allowed hosts to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: accept if packet match this rule">-j ACCEPT</a>
    <a title="Allow incoming active ftp packet from allowed hosts to Linux VM" >sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Action: accept this packet">-j ACCEPT</a>
    <a title="Allow incoming active ftp packet from allowed hosts to Linux VM" >sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 20 for ftp data   ">--dport 20</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Allow all ssh connections to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 22 for SSH">--dport 22</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Allow ping Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="ICMP protocol (ping)">-p icmp</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Allow all internal group 12 connections to Linux VM">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Source IP: if packet come from this IP">-s 10.229.12.0/24</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <!--#####################################################-->
    <h1>#Inbound rules for Windows VM</h1>

    <a title="Log incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.52</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.144</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.52.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.131</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP HTTP REQ "</a>
    <a title="Log incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.2.0/24</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP HTTP REQ "</a>

    <a title="Log incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.52</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.144</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.52.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.131</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP FTP REQ "</a>
    <a title="Log incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.2.0/24</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP FTP REQ "</a>

    <a title="Log incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.52 </a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.144</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.52.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.131</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS BLOCK FTP PASSIVE "</a>
    <a title="Log incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.2.0/24</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if a packet match this rule">-j LOG</a>  <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS BLOCK FTP PASSIVE "</a>

    <a title="Drop incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.52</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.144</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.52.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.131</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming http packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.2.0/24</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Allow incoming http packet from allowed hosts to Windows VM"  >sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 80 for http">--dport 80</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Drop incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.52</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.144</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.52.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.131</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming active ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.2.0/24</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Drop incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.52</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.144</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.52.0/24</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.100.131</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop incoming passive ftp packet from restricted hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.2.0/24</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Allow incoming passive ftp packet from allowed hosts to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a>  <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j ACCEPT</a>
    <a title="Allow incoming active ftp packet from allowed hosts to Windows VM" >sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 21 for ftp command">--dport 21</a> <a title="Action: accept this packet">-j ACCEPT</a>
    <a title="Allow incoming active ftp packet from allowed hosts to Windows VM" >sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.0.0/16</a>  <a title="TCP protocol">-p tcp</a> <a title="Destination port: 20 for ftp data   ">--dport 20</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Allow all ssh connections to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: 22 for SSH">--dport 22</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Allow ping Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="ICMP protocol (ping)">-p icmp</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <a title="Allow all internal group 12 connections to Windows VM">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Source IP: if packet come from this IP">-s 10.229.12.0/24</a> <a title="Action: accept this packet">-j ACCEPT</a>

    <!--#####################################################-->
    <h1>#Default inbound rules</h1>

    <a title="Log all incoming connections to Linux VM that are not allowed">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX default DROP ALL "</a>
    <a title="Drop all incoming connections to Linux VM that are not allowed">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Log all incoming passive ftp connections to Linux VM that are not allowed">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a> <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="LINUX default DROP FTP "</a>
    <a title="Drop all incoming passive ftp connections to Linux VM that are not allowed">sudo iptables</a> <a title="INPUT chain: this apply to all packet whose destination is Linux VM" >-A INPUT</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a> <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Log all incoming connections to Windows VM that are not allowed">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS default DROP ALL "</a>
    <a title="Drop all incoming connections to Windows VM that are not allowed">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>

    <a title="Log all incoming passive ftp connections to Windows VM that are not allowed">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a> <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: log if packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS default DROP FTP "</a>
    <a title="Drop all incoming passive ftp connections to Windows VM that are not allowed">sudo iptables</a> <a title="FORWARD chain to 10.229.12.5: this apply to all FORWARD packet whose destination is Windows VM" >-A FORWARD -d 10.229.12.5</a> <a title="TCP protocol">-p tcp</a> <a title="Destination port: passive FTP connection does not have fixed port, only > 1024">--dport 1024:65535</a> <a title="Load module helper to track ftp passive port">-m helper --helper "ftp"</a> <a title="All RELATED state packet for FTP passive" >-m state --state RELATED</a>  <a title="Action: drop if packet match this rule">-j DROP</a>

    <!--#####################################################-->
    <h1>#Outbound rules</h1>

    <a title="Log outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.100.140</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP otgoing REQ "</a>
    <a title="Log outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.11.0/24</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP otgoing REQ "</a>
    <a title="Log outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.100.52</a>  <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP otgoing REQ "</a>
    <a title="Log outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.52.0/24</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: log if a packet match this rule">-j LOG</a> <a title="Prefix to prepend to message logged in kern.log">--log-prefix="WINDOWS DROP otgoing REQ "</a>

    <a title="Drop outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.100.140</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.11.0/24</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.100.52</a>  <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>
    <a title="Drop outgoing packet from Windows VM to restricted hosts">sudo iptables</a> <a title="FORWARD chain from 10.229.12.5: this apply to all FORWARD packet coming from Windows VM to the &quot;internet&quot;" >-A FORWARD -s 10.229.12.5</a> <a title="Destination IP: if packet is going to this IP">-d 10.229.52.0/24</a> <a title="Load state module" >-m state</a> <a title="Only apply to NEW packet, ie packet that initiate the connection">--state NEW</a> <a title="Action: drop if packet match this rule">-j DROP</a>

    <!--#####################################################-->

</pre>

<script>
    for (let element of document.getElementsByTagName('a')) {
        element.setAttribute('href', '#'+makeid());
    }

    function makeid() {
        let text = "";
        const possible = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";

        for (let i = 0; i < 5; i++)
            text += possible.charAt(Math.floor(Math.random() * possible.length));

        return text;
    }

    $( function() {
        $( document ).tooltip();
    } );
</script>

<style>
    html {
        font-family: "Courier New", Courier, monospace;
    }
</style>

<!--
sudo iptables -A INPUT -s 10.229.100.140/32 -p tcp -m tcp --dport 1024:60000 -m helper --helper ftp -m state --state NEW -j LOG --log-prefix "passive new "
sudo iptables -A INPUT -s 10.229.100.140/32 -p tcp -m tcp --dport 1024:60000 -m helper --helper ftp -m state --state RELATED -j LOG --log-prefix "passive related "
sudo iptables -A INPUT -s 10.229.100.140/32 -p tcp -m tcp --dport 1024:60000 -m helper --helper ftp -m state --state ESTABLISHED -j LOG --log-prefix "passive established "
sudo iptables -A OUTPUT -p tcp -m tcp --dport 1024:60000 -m helper --helper ftp -m state --state ESTABLISHED -j LOG --log-prefix "output established "
sudo iptables -A OUTPUT -p tcp -m tcp --dport 1024:60000 -m helper --helper ftp -m state --state RELATED -j LOG --log-prefix "output related "
sudo iptables -A OUTPUT -p tcp -m tcp --dport 1024:60000 -m helper --helper ftp -m state --state NEW -j LOG --log-prefix "output new "
-->