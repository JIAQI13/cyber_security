import os
input_file = open('encrypted.enc', 'rb')

lookup_tbl = [[0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0 ],
                [0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8 ],
                [0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3 ],
                [0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb ],
                [0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa ],
                [0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5 ],
                [0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf ],
                [0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd ],
                [0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc ],
                [0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4 ],
                [0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe ],
                [0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7 ],
                [0x2, 0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6 ],
                [0x3, 0x1, 0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2 ],
                [0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1, 0x0, 0x8, 0x9 ],
                [0x0, 0x8, 0x9, 0xb, 0xa, 0xe, 0xf, 0xd, 0xc, 0x4, 0x5, 0x7, 0x6, 0x2, 0x3, 0x1 ]]

byte = input_file.read(1)

sequence = []

while byte != b"":
    hex_code = byte.hex()
    cl = hex_code[-1]
    ch = hex_code[-2] if hex_code[-2] != 'x' else '0'

    ph_kl = []
    pl_kh = []
    possible_p_k = {}
    for row in range(len(lookup_tbl)):
        for cell in range(len(lookup_tbl[row])):

            if lookup_tbl[row][cell] == int(ch, 16):
                ph_kl.append((hex(row).replace('0x', ''), hex(cell).replace('0x', '')))

            if lookup_tbl[row][cell] == int(cl, 16):
                pl_kh.append((hex(row).replace('0x', ''), hex(cell).replace('0x', '')))

    for ph,kl in ph_kl:
        for pl,kh in pl_kh:
            p_ascii = int(ph + pl, 16)
            # if p_ascii < 32 or p_ascii >= 127: continue
            k_ascii = int(kh + kl, 16)
            # if k_ascii < 32 or k_ascii >= 127: continue
            possible_p_k[chr(k_ascii)] = p_ascii

    sequence.append(possible_p_k)

    byte = input_file.read(1)

key_set = set(sequence[0].keys())
for key in key_set:
    if sequence[0][key] == 0xff and sequence[1][key] == 0xd8 and sequence[2][key] == 0xff:
        print(key)
        with open('isthis.jpg','wb') as out_file:
            for i in range(len(sequence)):
                out_file.write(bytes([sequence[i][key]]))
        os.startfile('isthis.jpg')